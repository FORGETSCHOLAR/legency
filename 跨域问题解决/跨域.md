# 环境

在springboot 和 vue 前后端分离的过程中，vue前端访问后端的端口会出现跨域问题。





# 解决

CrossDomainFilter.java

```
//跨域的过滤器
public class CrossDomainFilter implements Filter {

	@Override
	public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain)
			throws IOException, ServletException {
		HttpServletResponse httpResponse = (HttpServletResponse) response;

		// 允许所有的请求域名访问我们的跨域资源，可以固定单个或者多个内容
		//httpResponse.setHeader("Access-Control-Allow-Origin", "*");
		httpResponse.setHeader("Access-Control-Allow-Origin", "http://127.0.0.1:8081");

		httpResponse.setHeader("Access-Control-Allow-Methods", "POST, GET, OPTIONS, DELETE, PUT");// 允许何种请求方法访问该跨域资源服务器
		httpResponse.setHeader("Access-Control-Max-Age", "3600");// 预检请求的有效期，单位为秒。有效期内，不会重复发送预检请求
		httpResponse.addHeader("Access-Control-Allow-Headers",
				"Accept, Origin, No-Cache, X-Requested-With, If-Modified-Since, Pragma, Last-Modified, Cache-Control, Expires, Content-Type, X-E4M-With");// 允许所有的请求header访问，可以自定义设置任意请求头信息
		httpResponse.setHeader("Access-Control-Allow-Credentials", "true");// 是否允许用户发送、处理cookie
		httpResponse.setHeader("Access-Control-Expose-Headers", "Set-Cookie");

		chain.doFilter(request, httpResponse);
	}

	@Override
	public void init(FilterConfig filterConfig) throws ServletException {
		//log.info("-----CrossDomainFilter init -------");
	}

	@Override
	public void destroy() {

	}

}
```



MvcConfig.java

```
@Configuration
public class MvcConfig implements WebMvcConfigurer {

    @Bean
    public FilterRegistrationBean<CrossDomainFilter> filterRegistrationBean (){
        FilterRegistrationBean<CrossDomainFilter> filterRegistrationBean = new FilterRegistrationBean<>();
        filterRegistrationBean.setFilter(new CrossDomainFilter());
        filterRegistrationBean.addUrlPatterns("/*");
        filterRegistrationBean.setOrder(1);
        return filterRegistrationBean;
    }
}

```



# 注意

1、若前端携带 cookie 的请求，则Access-Control-Allow-Origin不可以设置为*





# Cookie 设置

```
ResponseCookie cookie = ResponseCookie.from("UserSessionID", String.valueOf(mdContent)) // key & value
    .httpOnly(false)		// 禁止js读取
    .secure(true)		// 在http下也传输
	//.domain("localhost")// 域名
    .path("/")			// path
    .maxAge(600000)	// 1个小时候过期
    .sameSite("None")	// 大多数情况也是不发送第三方 Cookie，但是导航到目标网址的 Get 请求除外
    .build()
    ;

response.setHeader(HttpHeaders.SET_COOKIE, cookie.toString());
```





# Vue 设置

必须设置 axios.defaults.withCredentials = true axios 在发送请求的时候才会自动带上cookie，因为跨域的时候axios默认是不会带cookie的。



```
// 引入axios
import axios from 'axios'
axios.defaults.baseURL = "http://127.0.0.1:8080"
// axios支持 
axios.defaults.withCredentials = true
Vue.prototype.$axios = axios
```

